{"ast":null,"code":"// src/store/cartStore.ts (エラー修正・完成版)\n\nimport { create } from \"zustand\";\n\n// ★ set, getに型を付けるためにインポート\n\n// ★★★ エラーの根本原因 ★★★\n// StoreState の型定義が消えていたので復活させます\n\n// ストアが持つアクション（状態を変更する関数）の型\n\n// ★ set, get に型を付けるための型定義\n\n// ★ create<AppState>() の中の (set, get) に型を明示的に指定します\nconst storeCreator = (set, get) => ({\n  // =============================\n  // 初期状態 (State)\n  // =============================\n  cart: [],\n  pendingOrders: [],\n  cartTotalAmount: 0,\n  pendingOrderTotalAmount: 0,\n  menuItems: [],\n  // ============================= // アクション (Actions) // =============================\n\n  fetchMenuItems: async () => {\n    try {\n      const response = await fetch(\"http://localhost:3000/api/menu\");\n      if (!response.ok) {\n        throw new Error(\"メニューの取得に失敗しました\");\n      }\n      const data = await response.json();\n      set({\n        menuItems: data\n      });\n    } catch (error) {\n      console.error(\"メニューのフェッチに失敗:\", error);\n    }\n  },\n  // ★ 'any' エラーを修正\n  updateCart: (menuItemId, quantity, selectedOptions = [] // 型を明示\n  ) => {\n    const menuItem = get().menuItems.find(m => m.id === menuItemId); // ★ 'm' に型\n    if (!menuItem) return;\n    const optionsId = selectedOptions.map(opt => opt.name) // ★ 'opt' に型\n    .sort().join(\"-\");\n    const cartItemId = `${menuItemId}-${optionsId}`;\n    let newCart = [...get().cart];\n    const existingItemIndex = newCart.findIndex(item => item.id === cartItemId // ★ 'item' に型\n    );\n    if (quantity <= 0) {\n      if (existingItemIndex > -1) newCart.splice(existingItemIndex, 1);\n    } else if (existingItemIndex > -1) {\n      newCart[existingItemIndex] = {\n        ...newCart[existingItemIndex],\n        quantity\n      };\n    } else {\n      const optionsPrice = selectedOptions.reduce((total, opt) => total + opt.price,\n      // ★ 'total', 'opt' に型\n      0);\n      newCart.push({\n        id: cartItemId,\n        menuItemId,\n        name: menuItem.name,\n        price: menuItem.price + optionsPrice,\n        quantity,\n        selectedOptions\n      });\n    }\n    const newTotal = newCart.reduce((total, item) => total + item.price * item.quantity,\n    // ★ 'total', 'item' に型\n    0);\n    set({\n      cart: newCart,\n      cartTotalAmount: newTotal\n    });\n  },\n  // ★ 'any' エラーを修正\n  placeOrder: async tableNumber => {\n    const {\n      cart,\n      cartTotalAmount,\n      menuItems\n    } = get();\n    if (cart.length === 0) {\n      alert(\"カートに商品がありません。\");\n      return null;\n    }\n    const itemsPayload = cart.map(cartItem => ({\n      // ★ 'cartItem' に型\n      id: cartItem.menuItemId,\n      quantity: cartItem.quantity\n    }));\n    try {\n      const response = await fetch(\"http://localhost:3000/api/orders\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify({\n          table_number: tableNumber,\n          items: itemsPayload\n        })\n      });\n      if (!response.ok) {\n        throw new Error(\"注文の送信に失敗しました\");\n      }\n      const result = await response.json();\n      console.log(\"バックエンドへの注文送信成功:\", result);\n      const orderItems = cart.map(cartItem => {\n        // ★ 'cartItem' に型\n        const menuItem = menuItems.find(m => m.id === cartItem.menuItemId); // ★ 'm' に型\n        return {\n          ...menuItem,\n          price: cartItem.price,\n          quantity: cartItem.quantity,\n          selectedOptions: cartItem.selectedOptions\n        };\n      });\n      const newOrder = {\n        id: `be-${result.orderId}`,\n        tableNumber,\n        items: orderItems,\n        totalAmount: cartTotalAmount,\n        timestamp: Date.now()\n      };\n      set(state => ({\n        // ★ 'state' に型\n        pendingOrders: [...state.pendingOrders, newOrder],\n        pendingOrderTotalAmount: state.pendingOrderTotalAmount + cartTotalAmount,\n        cart: [],\n        cartTotalAmount: 0\n      }));\n      return newOrder;\n    } catch (error) {\n      console.error(\"注文の送信中にエラーが発生:\", error);\n      alert(\"注文の送信に失敗しました。もう一度お試しください。\");\n      return null;\n    }\n  },\n  clearCart: () => set({\n    cart: [],\n    cartTotalAmount: 0\n  }),\n  clearPendingOrders: () => set({\n    pendingOrders: [],\n    pendingOrderTotalAmount: 0\n  })\n});\nconst useCartStore = create(storeCreator); // ★ create<AppState>() から変更\n\nexport default useCartStore;","map":{"version":3,"names":["create","storeCreator","set","get","cart","pendingOrders","cartTotalAmount","pendingOrderTotalAmount","menuItems","fetchMenuItems","response","fetch","ok","Error","data","json","error","console","updateCart","menuItemId","quantity","selectedOptions","menuItem","find","m","id","optionsId","map","opt","name","sort","join","cartItemId","newCart","existingItemIndex","findIndex","item","splice","optionsPrice","reduce","total","price","push","newTotal","placeOrder","tableNumber","length","alert","itemsPayload","cartItem","method","headers","body","JSON","stringify","table_number","items","result","log","orderItems","newOrder","orderId","totalAmount","timestamp","Date","now","state","clearCart","clearPendingOrders","useCartStore"],"sources":["C:/Users/arsuser/Documents/24A18/卒業研究/main/resto-app/src/store/cartStore.ts"],"sourcesContent":["// src/store/cartStore.ts (エラー修正・完成版)\r\n\r\nimport { create } from \"zustand\";\r\nimport { CartItem, Order, OrderItem, Option, MenuItem } from \"../types\";\r\nimport { StateCreator } from \"zustand\"; // ★ set, getに型を付けるためにインポート\r\n\r\n// ★★★ エラーの根本原因 ★★★\r\n// StoreState の型定義が消えていたので復活させます\r\ninterface StoreState {\r\n  cart: CartItem[];\r\n  pendingOrders: Order[];\r\n  cartTotalAmount: number;\r\n  pendingOrderTotalAmount: number;\r\n  menuItems: MenuItem[];\r\n}\r\n\r\n// ストアが持つアクション（状態を変更する関数）の型\r\ninterface StoreActions {\r\n  updateCart: (\r\n    menuItemId: string,\r\n    quantity: number,\r\n    selectedOptions?: Option[]\r\n  ) => void;\r\n  placeOrder: (tableNumber: string) => Promise<Order | null>;\r\n  clearCart: () => void;\r\n  clearPendingOrders: () => void;\r\n  fetchMenuItems: () => Promise<void>;\r\n}\r\n\r\n// ★ set, get に型を付けるための型定義\r\ntype AppState = StoreState & StoreActions;\r\n\r\n// ★ create<AppState>() の中の (set, get) に型を明示的に指定します\r\nconst storeCreator: StateCreator<AppState> = (set, get) => ({\r\n  // =============================\r\n  // 初期状態 (State)\r\n  // =============================\r\n  cart: [],\r\n  pendingOrders: [],\r\n  cartTotalAmount: 0,\r\n  pendingOrderTotalAmount: 0,\r\n  menuItems: [], // ============================= // アクション (Actions) // =============================\r\n\r\n  fetchMenuItems: async () => {\r\n    try {\r\n      const response = await fetch(\"http://localhost:3000/api/menu\");\r\n      if (!response.ok) {\r\n        throw new Error(\"メニューの取得に失敗しました\");\r\n      }\r\n      const data: MenuItem[] = await response.json();\r\n      set({ menuItems: data });\r\n    } catch (error) {\r\n      console.error(\"メニューのフェッチに失敗:\", error);\r\n    }\r\n  },\r\n\r\n  // ★ 'any' エラーを修正\r\n  updateCart: (\r\n    menuItemId: string,\r\n    quantity: number,\r\n    selectedOptions: Option[] = [] // 型を明示\r\n  ) => {\r\n    const menuItem = get().menuItems.find((m: MenuItem) => m.id === menuItemId); // ★ 'm' に型\r\n    if (!menuItem) return;\r\n\r\n    const optionsId = selectedOptions\r\n      .map((opt: Option) => opt.name) // ★ 'opt' に型\r\n      .sort()\r\n      .join(\"-\");\r\n    const cartItemId = `${menuItemId}-${optionsId}`;\r\n\r\n    let newCart = [...get().cart];\r\n    const existingItemIndex = newCart.findIndex(\r\n      (item: CartItem) => item.id === cartItemId // ★ 'item' に型\r\n    );\r\n\r\n    if (quantity <= 0) {\r\n      if (existingItemIndex > -1) newCart.splice(existingItemIndex, 1);\r\n    } else if (existingItemIndex > -1) {\r\n      newCart[existingItemIndex] = { ...newCart[existingItemIndex], quantity };\r\n    } else {\r\n      const optionsPrice = selectedOptions.reduce(\r\n        (total: number, opt: Option) => total + opt.price, // ★ 'total', 'opt' に型\r\n        0\r\n      );\r\n      newCart.push({\r\n        id: cartItemId,\r\n        menuItemId,\r\n        name: menuItem.name,\r\n        price: menuItem.price + optionsPrice,\r\n        quantity,\r\n        selectedOptions,\r\n      });\r\n    }\r\n\r\n    const newTotal = newCart.reduce(\r\n      (total: number, item: CartItem) => total + item.price * item.quantity, // ★ 'total', 'item' に型\r\n      0\r\n    );\r\n    set({ cart: newCart, cartTotalAmount: newTotal });\r\n  },\r\n\r\n  // ★ 'any' エラーを修正\r\n  placeOrder: async (tableNumber: string) => {\r\n    const { cart, cartTotalAmount, menuItems } = get();\r\n    if (cart.length === 0) {\r\n      alert(\"カートに商品がありません。\");\r\n      return null;\r\n    }\r\n\r\n    const itemsPayload = cart.map((cartItem: CartItem) => ({\r\n      // ★ 'cartItem' に型\r\n      id: cartItem.menuItemId,\r\n      quantity: cartItem.quantity,\r\n    }));\r\n\r\n    try {\r\n      const response = await fetch(\"http://localhost:3000/api/orders\", {\r\n        method: \"POST\",\r\n        headers: {\r\n          \"Content-Type\": \"application/json\",\r\n        },\r\n        body: JSON.stringify({\r\n          table_number: tableNumber,\r\n          items: itemsPayload,\r\n        }),\r\n      });\r\n\r\n      if (!response.ok) {\r\n        throw new Error(\"注文の送信に失敗しました\");\r\n      }\r\n\r\n      const result = await response.json();\r\n      console.log(\"バックエンドへの注文送信成功:\", result);\r\n\r\n      const orderItems: OrderItem[] = cart.map((cartItem: CartItem) => {\r\n        // ★ 'cartItem' に型\r\n        const menuItem = menuItems.find(\r\n          (m: MenuItem) => m.id === cartItem.menuItemId\r\n        )!; // ★ 'm' に型\r\n        return {\r\n          ...menuItem,\r\n          price: cartItem.price,\r\n          quantity: cartItem.quantity,\r\n          selectedOptions: cartItem.selectedOptions,\r\n        };\r\n      });\r\n\r\n      const newOrder: Order = {\r\n        id: `be-${result.orderId}`,\r\n        tableNumber,\r\n        items: orderItems,\r\n        totalAmount: cartTotalAmount,\r\n        timestamp: Date.now(),\r\n      };\r\n\r\n      set((state: StoreState) => ({\r\n        // ★ 'state' に型\r\n        pendingOrders: [...state.pendingOrders, newOrder],\r\n        pendingOrderTotalAmount:\r\n          state.pendingOrderTotalAmount + cartTotalAmount,\r\n        cart: [],\r\n        cartTotalAmount: 0,\r\n      }));\r\n      return newOrder;\r\n    } catch (error) {\r\n      console.error(\"注文の送信中にエラーが発生:\", error);\r\n      alert(\"注文の送信に失敗しました。もう一度お試しください。\");\r\n      return null;\r\n    }\r\n  },\r\n\r\n  clearCart: () => set({ cart: [], cartTotalAmount: 0 }),\r\n  clearPendingOrders: () =>\r\n    set({ pendingOrders: [], pendingOrderTotalAmount: 0 }),\r\n});\r\n\r\nconst useCartStore = create(storeCreator); // ★ create<AppState>() から変更\r\n\r\nexport default useCartStore;\r\n"],"mappings":"AAAA;;AAEA,SAASA,MAAM,QAAQ,SAAS;;AAEQ;;AAExC;AACA;;AASA;;AAaA;;AAGA;AACA,MAAMC,YAAoC,GAAGA,CAACC,GAAG,EAAEC,GAAG,MAAM;EAC1D;EACA;EACA;EACAC,IAAI,EAAE,EAAE;EACRC,aAAa,EAAE,EAAE;EACjBC,eAAe,EAAE,CAAC;EAClBC,uBAAuB,EAAE,CAAC;EAC1BC,SAAS,EAAE,EAAE;EAAE;;EAEfC,cAAc,EAAE,MAAAA,CAAA,KAAY;IAC1B,IAAI;MACF,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAAC,gCAAgC,CAAC;MAC9D,IAAI,CAACD,QAAQ,CAACE,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,gBAAgB,CAAC;MACnC;MACA,MAAMC,IAAgB,GAAG,MAAMJ,QAAQ,CAACK,IAAI,CAAC,CAAC;MAC9Cb,GAAG,CAAC;QAAEM,SAAS,EAAEM;MAAK,CAAC,CAAC;IAC1B,CAAC,CAAC,OAAOE,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,eAAe,EAAEA,KAAK,CAAC;IACvC;EACF,CAAC;EAED;EACAE,UAAU,EAAEA,CACVC,UAAkB,EAClBC,QAAgB,EAChBC,eAAyB,GAAG,EAAE,CAAC;EAAA,KAC5B;IACH,MAAMC,QAAQ,GAAGnB,GAAG,CAAC,CAAC,CAACK,SAAS,CAACe,IAAI,CAAEC,CAAW,IAAKA,CAAC,CAACC,EAAE,KAAKN,UAAU,CAAC,CAAC,CAAC;IAC7E,IAAI,CAACG,QAAQ,EAAE;IAEf,MAAMI,SAAS,GAAGL,eAAe,CAC9BM,GAAG,CAAEC,GAAW,IAAKA,GAAG,CAACC,IAAI,CAAC,CAAC;IAAA,CAC/BC,IAAI,CAAC,CAAC,CACNC,IAAI,CAAC,GAAG,CAAC;IACZ,MAAMC,UAAU,GAAG,GAAGb,UAAU,IAAIO,SAAS,EAAE;IAE/C,IAAIO,OAAO,GAAG,CAAC,GAAG9B,GAAG,CAAC,CAAC,CAACC,IAAI,CAAC;IAC7B,MAAM8B,iBAAiB,GAAGD,OAAO,CAACE,SAAS,CACxCC,IAAc,IAAKA,IAAI,CAACX,EAAE,KAAKO,UAAU,CAAC;IAC7C,CAAC;IAED,IAAIZ,QAAQ,IAAI,CAAC,EAAE;MACjB,IAAIc,iBAAiB,GAAG,CAAC,CAAC,EAAED,OAAO,CAACI,MAAM,CAACH,iBAAiB,EAAE,CAAC,CAAC;IAClE,CAAC,MAAM,IAAIA,iBAAiB,GAAG,CAAC,CAAC,EAAE;MACjCD,OAAO,CAACC,iBAAiB,CAAC,GAAG;QAAE,GAAGD,OAAO,CAACC,iBAAiB,CAAC;QAAEd;MAAS,CAAC;IAC1E,CAAC,MAAM;MACL,MAAMkB,YAAY,GAAGjB,eAAe,CAACkB,MAAM,CACzC,CAACC,KAAa,EAAEZ,GAAW,KAAKY,KAAK,GAAGZ,GAAG,CAACa,KAAK;MAAE;MACnD,CACF,CAAC;MACDR,OAAO,CAACS,IAAI,CAAC;QACXjB,EAAE,EAAEO,UAAU;QACdb,UAAU;QACVU,IAAI,EAAEP,QAAQ,CAACO,IAAI;QACnBY,KAAK,EAAEnB,QAAQ,CAACmB,KAAK,GAAGH,YAAY;QACpClB,QAAQ;QACRC;MACF,CAAC,CAAC;IACJ;IAEA,MAAMsB,QAAQ,GAAGV,OAAO,CAACM,MAAM,CAC7B,CAACC,KAAa,EAAEJ,IAAc,KAAKI,KAAK,GAAGJ,IAAI,CAACK,KAAK,GAAGL,IAAI,CAAChB,QAAQ;IAAE;IACvE,CACF,CAAC;IACDlB,GAAG,CAAC;MAAEE,IAAI,EAAE6B,OAAO;MAAE3B,eAAe,EAAEqC;IAAS,CAAC,CAAC;EACnD,CAAC;EAED;EACAC,UAAU,EAAE,MAAOC,WAAmB,IAAK;IACzC,MAAM;MAAEzC,IAAI;MAAEE,eAAe;MAAEE;IAAU,CAAC,GAAGL,GAAG,CAAC,CAAC;IAClD,IAAIC,IAAI,CAAC0C,MAAM,KAAK,CAAC,EAAE;MACrBC,KAAK,CAAC,eAAe,CAAC;MACtB,OAAO,IAAI;IACb;IAEA,MAAMC,YAAY,GAAG5C,IAAI,CAACuB,GAAG,CAAEsB,QAAkB,KAAM;MACrD;MACAxB,EAAE,EAAEwB,QAAQ,CAAC9B,UAAU;MACvBC,QAAQ,EAAE6B,QAAQ,CAAC7B;IACrB,CAAC,CAAC,CAAC;IAEH,IAAI;MACF,MAAMV,QAAQ,GAAG,MAAMC,KAAK,CAAC,kCAAkC,EAAE;QAC/DuC,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UACP,cAAc,EAAE;QAClB,CAAC;QACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAAC;UACnBC,YAAY,EAAEV,WAAW;UACzBW,KAAK,EAAER;QACT,CAAC;MACH,CAAC,CAAC;MAEF,IAAI,CAACtC,QAAQ,CAACE,EAAE,EAAE;QAChB,MAAM,IAAIC,KAAK,CAAC,cAAc,CAAC;MACjC;MAEA,MAAM4C,MAAM,GAAG,MAAM/C,QAAQ,CAACK,IAAI,CAAC,CAAC;MACpCE,OAAO,CAACyC,GAAG,CAAC,iBAAiB,EAAED,MAAM,CAAC;MAEtC,MAAME,UAAuB,GAAGvD,IAAI,CAACuB,GAAG,CAAEsB,QAAkB,IAAK;QAC/D;QACA,MAAM3B,QAAQ,GAAGd,SAAS,CAACe,IAAI,CAC5BC,CAAW,IAAKA,CAAC,CAACC,EAAE,KAAKwB,QAAQ,CAAC9B,UACrC,CAAE,CAAC,CAAC;QACJ,OAAO;UACL,GAAGG,QAAQ;UACXmB,KAAK,EAAEQ,QAAQ,CAACR,KAAK;UACrBrB,QAAQ,EAAE6B,QAAQ,CAAC7B,QAAQ;UAC3BC,eAAe,EAAE4B,QAAQ,CAAC5B;QAC5B,CAAC;MACH,CAAC,CAAC;MAEF,MAAMuC,QAAe,GAAG;QACtBnC,EAAE,EAAE,MAAMgC,MAAM,CAACI,OAAO,EAAE;QAC1BhB,WAAW;QACXW,KAAK,EAAEG,UAAU;QACjBG,WAAW,EAAExD,eAAe;QAC5ByD,SAAS,EAAEC,IAAI,CAACC,GAAG,CAAC;MACtB,CAAC;MAED/D,GAAG,CAAEgE,KAAiB,KAAM;QAC1B;QACA7D,aAAa,EAAE,CAAC,GAAG6D,KAAK,CAAC7D,aAAa,EAAEuD,QAAQ,CAAC;QACjDrD,uBAAuB,EACrB2D,KAAK,CAAC3D,uBAAuB,GAAGD,eAAe;QACjDF,IAAI,EAAE,EAAE;QACRE,eAAe,EAAE;MACnB,CAAC,CAAC,CAAC;MACH,OAAOsD,QAAQ;IACjB,CAAC,CAAC,OAAO5C,KAAK,EAAE;MACdC,OAAO,CAACD,KAAK,CAAC,gBAAgB,EAAEA,KAAK,CAAC;MACtC+B,KAAK,CAAC,2BAA2B,CAAC;MAClC,OAAO,IAAI;IACb;EACF,CAAC;EAEDoB,SAAS,EAAEA,CAAA,KAAMjE,GAAG,CAAC;IAAEE,IAAI,EAAE,EAAE;IAAEE,eAAe,EAAE;EAAE,CAAC,CAAC;EACtD8D,kBAAkB,EAAEA,CAAA,KAClBlE,GAAG,CAAC;IAAEG,aAAa,EAAE,EAAE;IAAEE,uBAAuB,EAAE;EAAE,CAAC;AACzD,CAAC,CAAC;AAEF,MAAM8D,YAAY,GAAGrE,MAAM,CAACC,YAAY,CAAC,CAAC,CAAC;;AAE3C,eAAeoE,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}